<head>
    <title>Torrent Contents Explorer: FBI Not Allowed</title>
    <meta name="description" content="Open files in browser, no need to download to PC"/>
    <meta name="keywords" content="piratebay, thepiratebay, rutracker, nyaa pantsu">

    <meta property="twitter:site" content="@kunkka-torrent">
    <meta property="twitter:card" content="summary">
    <meta property="twitter:image:src" content="https://kunkka-torrent.online/assets/img/kunkka-torrent-masked.png">
    <meta property="twitter:title" content="Torrent Contents Explorer">
    <meta property="twitter:description" content="Open files in browser, no need to download to PC">

    <!-- FB, VK i drugie -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Torrent Contents Explorer">
    <meta property="og:description" content="Open files in browser, no need to download to PC">
    <meta property="og:image" content="https://kunkka-torrent.online/assets/img/kunkka-torrent-masked.png">
    <meta property="og:image:width" content="640">
    <meta property="og:image:height" content="300">

    <meta charset="utf-8"/>
    <link rel="icon" href="./favicon.ico"/>
    <link rel="stylesheet" href="./styles/common.css"/>
</head>

<!-- possibly should move it to /public/ -->
<style>
    .first-episodes-card-list {
        text-align: center;
    }
    .first-episodes-card-list > div {
        display: inline-block;
        margin: 4px;
        border: solid #565555 2px;
        background-color: #3d4044d9;
    }
    .first-episodes-card-list > div > div > h4 {
        display: flex;
        flex-direction: column;
        flex: 1;
    }
    .first-episodes-card-list > div > div > div {
        width: 512px;
        height: 288px;
        position: relative;
        flex: 1;
        display: flex;
    }
    .first-episodes-card-list video {
        left: 0;
        right: 0;
        margin: auto;
        max-width: 100%;
        height: 100%;
        position: absolute;
        object-fit: contain;
        background-image: url(./assets/img/static_noise.png);
    }
    li {
        text-align: left;
        cursor: pointer;
    }
    li:hover {
        color: #2d9bc7;
    }
</style>

<body>
    <header>
        <div class="header-text-block-space">
            <div class="header-title-with-search-form">
                <div class="header-main-title">
                    <a href="https://torrent.klesun.net">
                        <span class="kunkka-color">kunkka</span>-<span class="torrent-color">torrent</span>
                    </a>
                </div>
                <div>
                    <form method="get" action="./views/search.html">
                        <input required="required" placeholder="Type file name here" name="pattern" type="text"/>
                        <select name="category">
                            <option selected value="all">All categories</option>
                            <option disabled="">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
                            <option value="anime">Anime</option>
                            <option value="books">Books</option>
                            <option value="games">Games</option>
                            <option value="movies">Movies</option>
                            <option value="music">Music</option>
                            <option value="pictures">Pictures</option>
                            <option value="software">Software</option>
                            <option value="tv">TV shows</option>
                        </select>
                        <input type="hidden" name="plugins" value="all"/>
                        <button>Search</button>
                    </form>
                </div>
            </div>
            <p class="title-secondary-text">Torrent contents explorer - open files in browser, no need to download to PC</p>
        </div>
        <div class="header-image-remainder-space"></div>
    </header>

<!-- TODO: indent -->
<main style="text-align: center">
    <h2>Watch Online Before FBI Puts Me Down</h2>
    <h3>Editor's Choice</h3>

    <!-- would be cool, if guy already watched first episode (localStorage) to suggest next unwatched episode in this list -->
    <!-- also, for visual purposes would be cool to scroll video to random point (on playback start event - rewind to start on the first time) -->
    <div class="first-episodes-card-list">
        <div><div>
            <h4>My Little Pony S01E01</h4>
            <div>
                <video controls="controls" src="https://torrent.klesun.net/kunkka_host/handmaide/torrent_downloads/MLPFiM/Season%201/MLP_FiM - S01E01 - Friendship is Magic Part 1.mkv">
                    <track src="https://torrent.klesun.net/kunkka_host/handmaide/torrent_downloads/MLPFiM/Season%201/subs.vtt" default kind="subtitles" label="English" srclang="en"/>
                </video>
            </div>
        </div></div>
        <div><div>
            <h4>Kenan And Kel S01E01</h4>
            <div>
                <video controls="controls" src="https://torrent.klesun.net/kunkka_host/handmaide/torrent_downloads/Kenan%20And%20Kel%20Complete%20Pack%20(Tv%20series,%20Pilot,%202%20movies)%20(WAZZ)/Kenan%20And%20Kel%20Season%201/h264.mp4">
                    <track default kind="subtitles" label="English" srclang="en"/>
                </video>
            </div>
        </div></div>
        <div><div>
            <h4>Mob Psycho 100 S01E01</h4>
            <div>
                <video controls="controls" src="https://torrent.klesun.net/kunkka_host/handmaide/torrent_downloads/Mob%20Psycho%20100%20Season%201%20%5BEng%20Sub%5D/Mob%20Psycho%20100%20-%2001%20%5B1080p%5D.mkv">
                    <track default kind="subtitles" label="English" srclang="en"/>
                </video>
            </div>
        </div></div>
        <div><div>
            <h4>Breaking Bad S01E01</h4>
            <div>
                <video controls="controls" src="https://torrent.klesun.net/kunkka_host/handmaide/torrent_downloads/Breaking%20Bad/Breaking%20Bad%20Season%201/Breaking%20Bad%20-%20%5B1x01%5D%20-%20Pilot.mkv">
                    <track src="https://torrent.klesun.net/kunkka_host/handmaide/torrent_downloads/Breaking%20Bad/Breaking%20Bad%20Season%201/S01E01.vtt" default kind="subtitles" label="English" srclang="en"/>
                </video>
            </div>
        </div></div>
        <div><div>
            <h4>Adventure Time S01E01</h4>
            <div>
                <video controls="controls" src="https://torrent.klesun.net/kunkka_host/handmaide/torrent_downloads/Adventure%20Time%20S01-S10%20(2010-)/Adventure%20Time%20S01%20(360p%20re-blurip)/Adventure%20Time%20S01E01%20Slumber%20Party%20Panic.mp4">
                    <track default kind="subtitles" label="English" srclang="en"/>
                </video>
            </div>
        </div></div>
        <div><div>
            <h4>Humanity Declined S01E01</h4>
            <div>
                <video controls="controls" src="https://torrent.klesun.net/kunkka_host/handmaide/torrent_downloads/Jinrui%20wa%20Suitai%20Shimashita/%5BNemDiggers%5D%20Jinrui%20wa%20Suitai%20Shimashita%20-%2001%20%5BBD%5D%20%5B720p%5D%20%5BH264%20AAC%20MP4%5D.mp4">
                    <track default kind="subtitles" label="English" srclang="en"/>
                </video>
            </div>
        </div></div>
        <div><div>
            <h4>Daria S01E01</h4>
            <div>
                <video controls="controls" src="https://torrent.klesun.net/kunkka_host/handmaide/torrent_downloads/Daria/Season%201/Daria%20-%20S01E01%20-%20Esteemsters.mp4">
                    <track default kind="subtitles" label="English" srclang="en"/>
                </video>
            </div>
        </div></div>
        <div><div>
            <h4>Rick And Morty S01E01</h4>
            <div>
                <video controls="controls" src="https://torrent.klesun.net/kunkka_host/handmaide/torrent_downloads/Rick%20and%20Morty/Rick%20and%20Morty%20-%20Season%201/Rick%20and%20Morty%20-%20S01E01%20-%20Pilot.mp4">
                    <track default kind="subtitles" label="English" srclang="en"/>
                </video>
            </div>
        </div></div>
        <div><div>
            <h4>Steven Universe S01E01</h4>
            <div>
                <video controls="controls" src="https://torrent.klesun.net/kunkka_host/handmaide/torrent_downloads/%5BAliQ%5D%20Steven%20Universe%20Season%201%20%5B1080p%20WEB_DL%20x264%5D/%5BAliQ%5D%20S01E01%20-%20Gem%20Glow.mp4">
                    <track default kind="subtitles" label="English" srclang="en"/>
                </video>
            </div>
        </div></div>
    </div>

    <ul id="my-torrents-collection"></ul>
</main>

<script type="module">
    import TorrentNameParser from "./src/common/TorrentNameParser.js";
    import { loadModule } from "https://klesun.github.io/ts-browser/src/ts-browser.js";

    /** @param {HTMLElement} parent */
    const shuffleChildren = (parent) => {
        const cards = [...parent.children];
        for (const child of cards) {
            const newPlace = Math.floor(Math.random() * cards.length);
            parent.insertBefore(child, cards[newPlace + 1] || null);
        }
    };

    const firstEpisodesCardList = document.querySelector('.first-episodes-card-list');
    shuffleChildren(firstEpisodesCardList);
    [...firstEpisodesCardList.querySelectorAll('video')].forEach(video => {
        video.currentTime = Math.random() * 11 * 60;
    });

    const torrentsCollection = document.getElementById("my-torrents-collection");
    // language=file-reference
    const whenApi = loadModule("src/client/Api.ts").then(module => module.default());
    const openDir = async (path, level) => {
        const api = await whenApi;
        torrentsCollection.innerHTML = "";
        const showEntry = (dirent) => {
            const li = document.createElement('li');
            li.textContent = (dirent.isDirectory ? 'ðŸ“‚' : '') + dirent.name;
            const subPath = path + "/" + dirent.name;
            li.onclick = () => {
                const { parts } = TorrentNameParser(dirent);
                const { mediaType } = parts[0];
                if (dirent.isDirectory) {
                    openDir(subPath, level + 1);
                } else if (mediaType === 'video') {
                    window.open("./views/video-file-player.html?" + new URLSearchParams({ path: subPath }));
                } else {
                    window.open(subPath);
                }
            };
            torrentsCollection.appendChild(li);
        };
        if (level > 0) {
            showEntry({ isDirectory: true, name: ".." });
        }
        for await (const dirent of await api.listDirectory({ path: path })) {
            showEntry(dirent);
        }
    };
    await openDir('./kunkka_host/handmaide/torrent_downloads', 0);
</script>

</body>
